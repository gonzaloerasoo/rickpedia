<div *ngIf="isLoading" class="spinner-container">
  <mat-spinner></mat-spinner>
</div>

<div *ngIf="!isLoading && episode">
  <section class="section-header">
    <h2>{{ episode.name }}</h2>
    <p>{{ episode.episode }} — {{ episode.air_date }}</p>
  </section>

  <div class="card-grid" *ngIf="paginatedCharacters.length > 0">
    <div class="character-card" *ngFor="let character of paginatedCharacters">
      <div class="card-image">
        <img [src]="character.image" [alt]="character.name" />
      </div>
      <div class="card-content">
        <h3 class="name">{{ character.name }}</h3>
        <p class="meta">{{ character.species }} ({{ character.status }})</p>
        <p class="year">Año: {{ character.created | date : 'yyyy' }}</p>
      </div>
    </div>
  </div>

  <div class="pagination-wrapper">
    <div class="pagination-controls">
      <button type="button" (click)="prevPage()" [disabled]="currentPage === 1">
        Anterior
      </button>

      <button *ngIf="totalPages === 1" type="button" (click)="goToPage(1)" [class.active]="true">
        1
      </button>

      <ng-container *ngIf="totalPages > 1">
        <button type="button" (click)="goToPage(1)" [class.active]="currentPage === 1">
          1
        </button>

        <button *ngIf="showPrevEllipsis" type="button" (click)="handlePrevEllipsis()" class="ellipsis">
          ...
        </button>

        <button
          type="button"
          *ngFor="let page of visiblePageNumbers"
          (click)="goToPage(page)"
          [class.active]="currentPage === page"
        >
          {{ page }}
        </button>

        <button *ngIf="showNextEllipsis" type="button" (click)="handleNextEllipsis()" class="ellipsis">
          ...
        </button>

        <button
          type="button"
          (click)="goToPage(totalPages)"
          [class.active]="currentPage === totalPages"
        >
          {{ totalPages }}
        </button>
      </ng-container>

      <button type="button" (click)="nextPage()" [disabled]="currentPage === totalPages">
        Siguiente
      </button>
    </div>

    <div class="back-button">
      <button
        mat-stroked-button
        color="primary"
        (click)="goBack()"
        aria-label="Volver a episodios"
      >
        <span class="material-icons">arrow_back</span> Volver a episodios
      </button>
    </div>
  </div>
</div>
